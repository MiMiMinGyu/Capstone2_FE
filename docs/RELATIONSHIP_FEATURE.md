# 관계 설정 기능 가이드

> 최종 업데이트: 2025-11-20

---

## 📖 개요

관계 설정 기능은 사용자가 각 대화 상대와의 관계를 정의하여, AI가 생성하는 답변의 톤, 스타일, 이모지 사용을 자동으로 조정하는 기능입니다.

---

## 🎯 주요 기능

### 1. 관계 카테고리 (10종)

사용자와 대화 상대의 관계를 정의합니다. AI는 이 카테고리에 따라 적절한 톤과 표현을 선택합니다.

| 카테고리 | 한글명 | 설명 | AI 답변 예시 |
|---------|--------|------|-------------|
| `FAMILY_ELDER_CLOSE` | 어른 가족 (부모/조부모) | 부모님, 조부모님, 삼촌, 이모 등 | "네, 알겠습니다. 조금 있다가 연락드릴게요." |
| `FAMILY_SIBLING_ELDER` | 형/오빠/언니/누나 | 나이 많은 형제자매 | "네, 형! 오늘은 좀 바빠서 나중에 전화할게요." |
| `FAMILY_SIBLING_YOUNGER` | 남/여동생 | 나이 어린 형제자매 | "응, 알았어. 조금 이따 봐!" |
| `PARTNER_INTIMATE` | 연인/배우자 | 연인, 배우자 | "알았어 ❤️ 금방 갈게!" |
| `FRIEND_CLOSE` | 친한 친구 | 가까운 친구 | "ㅇㅋㅇㅋ 나중에 연락할게 ㅋㅋ" |
| `ACQUAINTANCE_CASUAL` | 가벼운 지인 | 처음 만난 사람, 가벼운 지인 | "네, 알겠습니다! 시간 되면 연락드릴게요." |
| `WORK_SENIOR_FORMAL` | 상사/교수/임원 | 상사, 교수님, 고객, 임원 | "네, 확인했습니다. 빠르게 처리하겠습니다." |
| `WORK_SENIOR_FRIENDLY` | 가까운 선배/멘토 | 친한 선배, 멘토 | "네, 선배님! 확인했어요. 금방 처리할게요." |
| `WORK_PEER` | 동료/파트너 | 동료, 협업 파트너 | "네, 확인했습니다. 오늘 중으로 공유드릴게요." |
| `WORK_JUNIOR` | 후배/인턴/팀원 | 후배, 인턴, 팀원 | "응, 확인했어. 이따 시간 되면 봐주도록 할게." |

### 2. 존댓말 수준 (3종)

대화의 격식 수준을 결정합니다.

| 레벨 | 한글명 | 설명 | 예시 |
|------|--------|------|------|
| `FORMAL` | 격식 존댓말 (-습니다) | 매우 격식있는 존댓말 | "확인했습니다", "처리하겠습니다" |
| `POLITE` | 일반 존댓말 (-요) | 일반적인 존댓말 | "확인했어요", "처리할게요" |
| `CASUAL` | 반말 | 편한 말투 | "확인했어", "처리할게" |

### 3. 대화 분위기 (4종)

답변의 전반적인 느낌을 조정합니다.

| 분위기 | 한글명 | 설명 | 예시 |
|--------|--------|------|------|
| `CALM` | 차분 | 진지하고 차분한 톤 | "네, 알겠습니다. 최대한 빠르게 확인할게요." |
| `DIRECT` | 직설적 | 간결하고 명확한 톤 | "ㅇㅋ. 나중에 연락할게." |
| `PLAYFUL` | 장난스러운 | 가볍고 재미있는 톤 | "ㅇㅋㅇㅋ ㅋㅋㅋ 나중에 봐!" |
| `CARING` | 배려하는 | 따뜻하고 배려하는 톤 | "네, 알겠어요! 걱정 마시고 기다려주세요 ^^" |

### 4. 이모지 사용 빈도 (0-5)

답변에 포함되는 이모지의 양을 조절합니다.

| 레벨 | 설명 | 예시 |
|------|------|------|
| 0 | 이모지 없음 | "알겠습니다. 나중에 연락드릴게요." |
| 1 | 매우 적음 | "알겠습니다. 나중에 연락드릴게요 ^^" |
| 2 | 적음 | "알겠어요! 나중에 연락할게요 😊" |
| 3 | 보통 | "알겠어요! 😊 나중에 연락드릴게요!" |
| 4 | 많음 | "알겠어요! 😊✨ 나중에 연락드릴게요! 💕" |
| 5 | 매우 많음 | "알겠어요! 😊✨💕 나중에 연락드릴게요! 🎉💖" |

---

## 🖥️ 사용 방법

### 1. 관계 설정 접근

1. MainPage에서 대화 상대 선택
2. ChatPage로 이동
3. 채팅 헤더 우측 **⚙️ 버튼** 클릭

### 2. 관계 정보 입력

**모달 구성:**
```
┌─────────────────────────────────────┐
│ 관계 설정                      ✕   │
├─────────────────────────────────────┤
│                                     │
│ 관계 카테고리                       │
│ [드롭다운: 친한 친구           ▼]  │
│                                     │
│ 존댓말 수준                         │
│ [드롭다운: 반말                ▼]  │
│                                     │
│ 대화 분위기                         │
│ [드롭다운: 장난스러운          ▼]  │
│                                     │
│ 이모지 사용 빈도: 3                 │
│ [슬라이더: ●──────]                │
│ 없음              매우 많음         │
│                                     │
├─────────────────────────────────────┤
│          [취소]      [저장]        │
└─────────────────────────────────────┘
```

### 3. 저장 및 확인

- **저장** 버튼 클릭 → 관계 정보 저장
- 채팅 헤더 부제목에 관계 카테고리 표시
  - 예: "친한 친구 · 5개의 메시지"
  - 미설정 시: "관계 미설정 · 5개의 메시지"

### 4. 관계 수정

- 동일한 방법으로 ⚙️ 버튼 클릭
- 기존 설정값이 자동으로 폼에 표시됨
- 원하는 항목 수정 후 저장

---

## 🔧 기술 구현

### API 엔드포인트

```javascript
// 관계 목록 조회
GET /relationships
Authorization: Bearer {access_token}

// 관계 생성
POST /relationships
Authorization: Bearer {access_token}
{
  "partnerId": "uuid",
  "category": "FRIEND_CLOSE",
  "politeness": "CASUAL",
  "vibe": "PLAYFUL",
  "emojiLevel": 3
}

// 관계 수정
PATCH /relationships/:id
Authorization: Bearer {access_token}
{
  "category": "FRIEND_CLOSE",
  "politeness": "POLITE",
  "vibe": "CALM",
  "emojiLevel": 2
}

// 관계 삭제
DELETE /relationships/:id
Authorization: Bearer {access_token}
```

### 프론트엔드 사용

```javascript
import { relationshipAPI, RELATIONSHIP_CATEGORIES, POLITENESS_LEVELS, VIBE_TYPES } from '@/api/endpoints/relationship';

// 관계 조회
const relationships = await relationshipAPI.getRelationships();
const currentRelationship = relationships.find(rel => rel.partner_id === partnerId);

// 관계 생성
await relationshipAPI.createRelationship({
  partnerId: partnerId,
  category: RELATIONSHIP_CATEGORIES.FRIEND_CLOSE,
  politeness: POLITENESS_LEVELS.CASUAL,
  vibe: VIBE_TYPES.PLAYFUL,
  emojiLevel: 3
});

// 관계 수정
await relationshipAPI.updateRelationship(relationshipId, {
  category: RELATIONSHIP_CATEGORIES.WORK_PEER,
  politeness: POLITENESS_LEVELS.POLITE,
  vibe: VIBE_TYPES.CALM,
  emojiLevel: 1
});
```

---

## 💡 사용 예시

### 예시 1: 부모님과의 대화

**설정:**
- 관계 카테고리: `FAMILY_ELDER_CLOSE` (어른 가족)
- 존댓말 수준: `FORMAL` (격식 존댓말)
- 대화 분위기: `CARING` (배려하는)
- 이모지 빈도: `1` (매우 적음)

**수신 메시지:** "오늘 저녁에 집에 와서 밥 먹을 수 있어?"

**AI 추천 답변:**
1. "네, 어머니. 저녁에 일찍 마치고 집에 가도록 하겠습니다."
2. "죄송합니다, 어머니. 오늘은 야근이 있어서 조금 늦을 것 같습니다."
3. "네, 가능합니다! 몇 시쯤 가면 될까요?"

---

### 예시 2: 친한 친구와의 대화

**설정:**
- 관계 카테고리: `FRIEND_CLOSE` (친한 친구)
- 존댓말 수준: `CASUAL` (반말)
- 대화 분위기: `PLAYFUL` (장난스러운)
- 이모지 빈도: `4` (많음)

**수신 메시지:** "야 오늘 저녁에 치맥 ㄱ?"

**AI 추천 답변:**
1. "ㅇㅋㅇㅋ 😆🍗 몇시에 어디서 볼까? 🍻"
2. "아 미안 ㅠㅠ 오늘 약속 있어서 다음에 가자 😭"
3. "ㄱㄱ! 🔥 오늘 진짜 땡기네 ㅋㅋㅋ 🍺✨"

---

### 예시 3: 상사와의 대화

**설정:**
- 관계 카테고리: `WORK_SENIOR_FORMAL` (상사)
- 존댓말 수준: `FORMAL` (격식 존댓말)
- 대화 분위기: `CALM` (차분)
- 이모지 빈도: `0` (없음)

**수신 메시지:** "내일 회의 자료 준비 상황 좀 알려주세요"

**AI 추천 답변:**
1. "네, 부장님. 현재 80% 정도 완료되었으며, 오늘 중으로 마무리하겠습니다."
2. "확인했습니다. 오후 3시까지 최종본 전달드리겠습니다."
3. "네, 말씀하신 내용 반영하여 작성 중입니다. 내일 오전까지 공유드리겠습니다."

---

## 🎨 UI/UX 가이드

### 모달 디자인

**색상:**
- 배경 오버레이: `rgba(0, 0, 0, 0.5)`
- 모달 배경: `#ffffff`
- 헤더/푸터 테두리: `#e0e0e0`
- 저장 버튼: `#007bff`
- 취소 버튼: `#ffffff` (테두리 `#e0e0e0`)

**크기:**
- 최대 너비: `480px`
- 최대 높이: `90vh`
- 모바일: 너비 `90%`

**애니메이션:**
- 오버레이 페이드인: `opacity 0.2s`
- 모달 슬라이드업: 없음 (즉시 표시)

### 슬라이더 스타일

**트랙:**
- 높이: `6px`
- 배경: `#e0e0e0`
- 모서리: `3px` 둥글게

**썸:**
- 크기: `20px × 20px`
- 색상: `#007bff`
- 호버 시: `#0056b3`

---

## ⚠️ 주의사항

### 1. 관계 미설정 시

- AI는 백엔드 기본값 사용
- 프론트엔드에서 "관계 미설정" 표시
- 관계 설정 권장 안내 (선택사항)

### 2. 관계 변경 시

- 기존 AI 답변에는 영향 없음
- 변경 이후 생성되는 답변부터 적용
- 실시간 반영됨

### 3. Partner 삭제 시

- Partner 삭제 시 관계도 함께 삭제됨 (CASCADE)
- 복구 불가능

### 4. 브라우저 호환성

- 슬라이더: Chrome, Firefox, Safari 지원
- 모달: 모든 모던 브라우저 지원
- IE11: 미지원

---

## 🐛 문제 해결

### Q1. 관계를 설정했는데 AI 답변이 안 바뀌어요

**확인 사항:**
1. 저장 버튼을 눌렀는지 확인
2. 네트워크 탭에서 API 응답 확인 (200 OK)
3. 새로운 메시지에 대해서만 적용됨 (기존 추천 답변은 유지)

**해결:**
- 새 메시지 수신 후 AI 추천 답변 재생성
- 또는 페이지 새로고침 후 재시도

---

### Q2. 슬라이더가 움직이지 않아요

**원인:**
- 브라우저 호환성 문제 (IE11)
- CSS 로딩 실패

**해결:**
- 모던 브라우저 (Chrome, Firefox, Safari) 사용
- 페이지 새로고침
- 브라우저 캐시 삭제

---

### Q3. 모달이 닫히지 않아요

**확인 사항:**
1. 오버레이 클릭 (모달 바깥 영역)
2. ✕ 버튼 클릭
3. 취소 버튼 클릭

**해결:**
- ESC 키 미지원 (향후 추가 예정)
- 페이지 새로고침

---

## 📌 향후 개선 계획

### 우선순위: 높음
- [ ] 관계 삭제 기능 추가
- [ ] ESC 키로 모달 닫기
- [ ] 관계 설정 안내 툴팁

### 우선순위: 중간
- [ ] 관계 프리셋 저장 (자주 쓰는 조합)
- [ ] 관계별 AI 답변 미리보기
- [ ] 모바일 터치 UX 개선

### 우선순위: 낮음
- [ ] 관계 변경 이력 조회
- [ ] 관계별 통계 (가장 많이 사용된 설정)
- [ ] 관계 추천 기능 (AI가 자동 추천)

---

## 📚 참고 자료

- [API 명세서](./API_SPECIFICATION.md#5-관계-relationships)
- [데이터베이스 스키마](./DB_SCHEMA.md)
- [프론트엔드 변경 이력](./FRONTEND_CHANGELOG.md)
- [백엔드 요청사항](./BACKEND_REQUESTS.md)
